{# Shared sticky filters toolbar for list and cards views #}
<div class="filters-sticky" id="filters-sticky" role="toolbar" aria-label="Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð½Ð¾Ð²Ð¾ÑÑ‚ÐµÐ¹">
  <div class="filters-inline">
    <div class="filter-buttons" id="filter-buttons" aria-live="polite" style="display:none;"></div>

    <div class="toolbar-group view-switch" aria-label="Ð’Ð¸Ð´">
      <button class="qt-btn" id="view-toggle-btn" onclick="switchViewToggle()" title="ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð²Ð¸Ð´">
        <!-- filled by script based on current page -->
      </button>
    </div>

    <div class="toolbar-group">
      <div class="since-controls" aria-label="ÐŸÐµÑ€Ð¸Ð¾Ð´">
        <button class="since-btn" data-since="24" onclick="setSinceHours(24)" aria-pressed="false" title="Ð·Ð° 24 Ñ‡Ð°ÑÐ°">24Ñ‡</button>
        <button class="since-btn" data-since="48" onclick="setSinceHours(48)" aria-pressed="false" title="Ð·Ð° 48 Ñ‡Ð°ÑÐ¾Ð²">48Ñ‡</button>
        <button class="since-btn" data-since="168" onclick="setSinceHours(168)" aria-pressed="false" title="Ð·Ð° 7 Ð´Ð½ÐµÐ¹">7Ð´</button>
      </div>
    </div>

    <div class="toolbar-group quick-toggles" aria-label="Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸">
      <!-- Categories button: only show on mobile when sidebar is hidden -->
      <button class="qt-btn qt-categories-mobile-only" id="qt-open-sheet" onclick="openCatSheet()" title="Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸">
        <span class="qt-ico">ðŸ“‚</span><span class="btn-label">ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸</span>
      </button>
      <button class="qt-btn" id="qt-hide-ads" onclick="toggleHideAds(!window.hideAds)" aria-pressed="true" title="Ð¡ÐºÑ€Ñ‹Ð²Ð°Ñ‚ÑŒ Ñ€ÐµÐºÐ»Ð°Ð¼Ñƒ">
        <span class="qt-ico">ðŸ§¹</span><span class="btn-label">Ð‘ÐµÐ· Ñ€ÐµÐºÐ»Ð°Ð¼Ñ‹</span>
      </button>

    </div>
  </div>
</div>

<script>
// One-time init for sticky toolbar: navbar offset and auto-hide on scroll
(function(){
  try {
    const nav = document.querySelector('.navbar');
    const applyHeight = () => {
      const h = (nav && nav.offsetHeight) ? nav.offsetHeight : 56;
      document.documentElement.style.setProperty('--navbar-height', h + 'px');
    };
    applyHeight();
    window.addEventListener('resize', applyHeight);
  } catch {}

  try {
    const sticky = document.getElementById('filters-sticky');
    let lastY = window.scrollY;
    window.addEventListener('scroll', () => {
      const y = window.scrollY;
      const down = y > lastY;
      const threshold = 20;
      if (Math.abs(y - lastY) > threshold) {
        if (down && y > 80) sticky?.classList.add('hide');
        else sticky?.classList.remove('hide');
        lastY = y;
      }
    }, { passive: true });
  } catch {}
})();
</script>

<script>
// Single toggle for view switch (list <-> cards)
(function(){
  try {
    const btn = document.getElementById('view-toggle-btn');
    const path = location.pathname;
    const isCards = /\/(cards|feed)$/.test(path);
    if (btn) {
      if (isCards) {
        btn.dataset.target = 'list';
        btn.innerHTML = '<span class="qt-ico">â‰¡</span><span class="btn-label">Ð›ÐµÐ½Ñ‚Ð°</span>';
        btn.title = 'ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð»ÐµÐ½Ñ‚Ñƒ';
      } else {
        btn.dataset.target = 'cards';
        btn.innerHTML = '<span class="qt-ico">âŠž</span><span class="btn-label">ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸</span>';
        btn.title = 'ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸';
      }
    }
  } catch {}
})();

function switchViewToggle(){
  const btn = document.getElementById('view-toggle-btn');
  const target = btn?.dataset.target;
  if (target === 'cards') window.location.href = '/cards';
  else window.location.href = '/';
}
</script>
