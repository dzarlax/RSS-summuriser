# RSS Generator

## Описание
Проект представляет собой систему для автоматического сбора, реферирования и публикации новостных статей. Используя стандартные и сторонние библиотеки Python, система анализирует RSS-каналы, извлекает из них новости, создает краткие рефераты статей и публикует их в формате RSS на указанный S3-хранилище. Помимо этого, проект включает функционал отправки уведомлений в Telegram о статусе обновления фида.

## Технологии
* Python 3.x
* Библиотеки: requests, feedparser, boto3, BeautifulSoup, feedgenerator, pytz, ratelimiter
* Интеграция с S3 (AWS или Yandex Cloud)
* Интеграция с Telegram API для уведомлений


## Установка

1. Клонируйте репозиторий:

```bash
git clone https://github.com/dzarlax/RSS-summuriser.git
cd RSS-summuriser
```

2. Создайте и активируйте виртуальное окружение:

```bash
python3 -m venv rss
source rss/bin/activate  # Для Windows: .\rss\Scripts\activate
 ```

3. Установите зависимости:

```bash
pip3 install -r requirements.txt
```

## Конфигурация

Перед запуском убедитесь, что вы настроили `config.json` с необходимыми параметрами.
### Конфигурационный файл

```
{
  "TELEGRAM_BOT_TOKEN": "<your_telegram_bot_token>",
  "TELEGRAM_CHAT_ID": "<your_telegram_chat_id>",
  "RPS": "10",
  "BUCKET_NAME": "<your_bucket_name>",
  "ENDPOINT_URL": "<your_endpoint_url>",
  "ACCESS_KEY": "<your_access_key>",
  "SECRET_KEY": "<your_secret_key>",
  "logo_url": "<your_logo_url>",
  "rss_url": "<your_rss_url>",
  "endpoint_300": "<your_endpoint_300>",
  "token_300": "<your_token_300>",
  "rss_300_file_name": "<your_rss_300_file_name>"
}
```
## Конфигурационный файл `config.json`

Ваш конфигурационный файл `config.json` должен содержать следующие ключи и их значения:

- **`"TELEGRAM_BOT_TOKEN"`**: Токен для вашего Telegram бота, используемого для отправки уведомлений.
  - **Формат**: Строка
  - **Пример**: `"123456789:ABCDEFghIJKlmnOPQRSTuvWXyzABCD_efG"`

- **`"TELEGRAM_CHAT_ID"`**: Идентификатор чата Telegram, куда будут отправляться уведомления.
  - **Формат**: Строка или число
  - **Пример**: `"123456789"`

- **`"RPS"`**: Максимальное количество запросов в секунду к внешнему API, чтобы избежать превышения лимитов.
  - **Формат**: Строка
  - **Пример**: `"10"`

- **`"BUCKET_NAME"`**: Имя бакета в S3-совместимом хранилище, куда будет загружаться RSS-фид.
  - **Формат**: Строка
  - **Пример**: `"my-rss-feeds"`

- **`"ENDPOINT_URL"`**: URL-адрес конечной точки S3-совместимого хранилища.
  - **Формат**: Строка
  - **Пример**: `"https://storage.yandexcloud.net"`

- **`"ACCESS_KEY"`**: Ключ доступа для аутентификации в S3-совместимом хранилище.
  - **Формат**: Строка
  - **Пример**: `"AKIDEXAMPLE"`

- **`"SECRET_KEY"`**: Секретный ключ для аутентификации в S3-совместимом хранилище.
  - **Формат**: Строка
  - **Пример**: `"wJalrXUtnFEMI/K7MDENG+bPxRfiCYEXAMPLEKEY"`

- **`"logo_url"`**: URL-адрес логотипа, используемого по умолчанию для RSS-фида, если не найдено другое изображение.
  - **Формат**: Строка
  - **Пример**: `"https://example.com/logo.png"`

- **`"rss_url"`**: URL-адрес исходного RSS-канала, из которого производится сбор новостей.
  - **Формат**: Строка
  - **Пример**: `"https://example.com/feed.xml"`

- **`"endpoint_300"`**: URL-адрес API для получения краткого содержания статей.
  - **Формат**: Строка
  - **Пример**: `"https://api.example.com/summarize"`

- **`"token_300"`**: Токен для аутентификации при запросах к API для получения краткого содержания.
  - **Формат**: Строка
  - **Пример**: `"example_token_300"`

- **`"rss_300_file_name"`**: Имя файла для сохранения сгенерированного RSS-фида в S3-хранилище.
  - **Формат**: Строка
  - **Пример**: `"rss_feed.xml"`

Эти параметры ключевые для настройки и работы вашего проекта. Убедитесь, что вы правильно заполнили все поля в соответствии с вашими требованиями и инфраструктурой.



## Запуск

```bash
python3 main_300.py
```

После выполнения скрипта результат будет загружен на S3.


## Зависимости

## Зависимости проекта

Проект использует стандартные библиотеки Python, а также сторонние библиотеки для реализации своих функций.

### Стандартные библиотеки

- `json` - Работа с JSON файлами и данными.
- `logging` - Логирование работы программы.
- `os` - Взаимодействие с операционной системой, работа с путями файлов.
- `tempfile` - Создание временных файлов.
- `datetime` - Работа с датами и временем.
- `typing` - Поддержка типизации данных.

### Сторонние библиотеки

Для установки сторонних библиотек используйте команду `pip install <название_библиотеки>`.

- `pytz` - Работа с временными зонами.
- `boto3` - Интерфейс для работы с Amazon Web Services (AWS), в том числе с S3.
- `feedparser` - Анализ RSS и Atom лент.
- `requests` - Отправка HTTP-запросов.
- `BeautifulSoup` (`beautifulsoup4`) - Парсинг HTML и XML документов.
- `feedgenerator` - Генерация RSS и Atom лент.
- `ratelimiter` - Ограничение скорости выполнения запросов.

Пример команды для установки всех сторонних зависимостей:

```bash
pip install pytz boto3 feedparser requests beautifulsoup4 feedgenerator ratelimiter
```

## Логгер

Логгер настроен так, чтобы записывать информацию в файл `output.log` и выводить её в стандартный поток вывода. Уровень логирования установлен на `INFO`.

## Описание функций проекта

Проект включает в себя ряд функций, каждая из которых выполняет конкретную задачу в процессе агрегации, обработки и публикации новостей.

### `load_config(key: Optional[str] = None)`
Загружает конфигурационные данные из файла `config.json`. Если указан ключ `key`, возвращает значение для этого ключа. В противном случае возвращает весь конфиг.

### `send_telegram_message(message)`
Отправляет сообщение в Telegram. Использует токен и ID чата из конфигурационного файла.

### `get_previous_feed_and_links(bucket_name: str, s3, object_name)`
Загружает и анализирует предыдущий RSS-фид из S3. Возвращает разобранный фид и список ссылок на статьи.

### `is_entry_recent(entry: feedparser.FeedParserDict, days_ago: datetime)`
Проверяет, была ли статья опубликована не позднее указанного числа дней назад.

### `upload_file_to_yandex(file_name: str, bucket: str, s3, object_name)`
Загружает файл в S3-совместимое хранилище (например, Яндекс.Облако).

### `extract_image_url(summary: Optional[str], logo: str)`
Извлекает URL изображения из контента статьи. В случае отсутствия изображения возвращает URL логотипа по умолчанию.

### `ya300(link, endpoint, token)`
Делает запрос к API для получения краткого содержания статьи по URL.

### `process_entry(entry: feedparser.FeedParserDict, days_ago: datetime, previous_links: List[str], logo: str, endpoint, token)`
Обрабатывает отдельную статью, проверяя на новизну, извлекая или генерируя краткое содержание и изображение.

### `main_func()`
Основная функция, координирующая процесс сбора, обработки и публикации новостей. Включает в себя инициализацию, обработку и публикацию.

Каждая функция спроектирована для выполнения определенной роли в проекте, обеспечивая его модульность и удобство поддержки.


